<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Digital Twin Viewer</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #1a1a2e; color: #eee; overflow: hidden; }
    #canvas-container { width: 100vw; height: 100vh; }
    canvas { display: block; }

    /* â”€â”€ Upload overlay â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #upload-overlay {
      position: fixed; inset: 0;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      background: rgba(26, 26, 46, 0.95); z-index: 100;
    }
    #upload-overlay.hidden { display: none; }
    #upload-overlay h1 { font-size: 1.8rem; margin-bottom: 0.5rem; }
    #upload-overlay p { color: #aaa; margin-bottom: 1.5rem; font-size: 0.95rem; }
    #drop-zone {
      width: 420px; padding: 48px 32px;
      border: 2px dashed #555; border-radius: 12px;
      text-align: center; cursor: pointer; transition: border-color 0.2s;
    }
    #drop-zone:hover, #drop-zone.dragover { border-color: #6c63ff; }
    #drop-zone input { display: none; }
    #drop-zone .icon { font-size: 2.5rem; margin-bottom: 0.5rem; }
    #drop-zone .label { font-size: 1rem; color: #ccc; }
    #drop-zone .hint { font-size: 0.8rem; color: #777; margin-top: 0.5rem; }
    #upload-status { margin-top: 1rem; color: #6c63ff; min-height: 1.5rem; }

    /* â”€â”€ HUD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #hud {
      position: fixed; top: 16px; left: 16px; z-index: 10;
      background: rgba(0,0,0,0.7); padding: 14px 18px; border-radius: 10px;
      font-size: 0.85rem; line-height: 1.7; min-width: 220px;
    }
    #hud h2 { font-size: 1rem; margin-bottom: 6px; color: #6c63ff; }
    #hud .row { display: flex; justify-content: space-between; }
    #hud .row span:first-child { color: #999; }

    /* â”€â”€ Controls panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #controls {
      position: fixed; top: 16px; right: 16px; z-index: 10;
      background: rgba(0,0,0,0.7); padding: 14px 18px; border-radius: 10px;
      font-size: 0.85rem; min-width: 200px;
    }
    #controls h2 { font-size: 1rem; margin-bottom: 8px; color: #6c63ff; }
    #controls label { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; cursor: pointer; }
    #controls input[type="checkbox"] { accent-color: #6c63ff; }
    #controls button {
      margin-top: 8px; width: 100%; padding: 8px;
      background: #6c63ff; color: #fff; border: none; border-radius: 6px;
      cursor: pointer; font-size: 0.85rem;
    }
    #controls button:hover { background: #5a52d5; }
    #controls button.active-mode { background: #e91e63; }
    #controls button.active-mode:hover { background: #c2185b; }
    #controls button.danger { background: #c62828; }
    #controls button.danger:hover { background: #b71c1c; }
    #controls button.warning { background: #e65100; }
    #controls button.warning:hover { background: #bf360c; }

    /* â”€â”€ Legend â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .legend { margin-top: 10px; }
    .legend-item { display: flex; align-items: center; gap: 6px; margin-bottom: 3px; }
    .legend-swatch { width: 12px; height: 12px; border-radius: 2px; }

    /* â”€â”€ Floating wall-preview labels â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #floating-labels {
      position: fixed; top: 0; left: 0;
      width: 100%; height: 100%;
      pointer-events: none; z-index: 20;
    }
    .wall-label {
      position: absolute;
      transform: translate(-50%, -100%);
      display: flex; gap: 4px;
      pointer-events: auto;
      padding-bottom: 6px;
    }
    .wall-label button {
      padding: 4px 10px; border: none; border-radius: 4px;
      cursor: pointer; font-size: 0.75rem; font-weight: 600;
      white-space: nowrap;
    }
    .wall-label .btn-gen { background: #4caf50; color: #fff; }
    .wall-label .btn-gen:hover { background: #388e3c; }
    .wall-label .btn-del { background: #c62828; color: #fff; }
    .wall-label .btn-del:hover { background: #b71c1c; }
    .wall-edit-label {
      position: absolute;
      transform: translate(-50%, -100%);
      pointer-events: auto;
      padding-bottom: 6px;
    }
    .wall-edit-label button {
      padding: 5px 14px; border: none; border-radius: 4px;
      cursor: pointer; font-size: 0.8rem; font-weight: 600;
      background: #c62828; color: #fff;
    }
    .wall-edit-label button:hover { background: #b71c1c; }

    /* â”€â”€ Walkthrough mode â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #walk-overlay {
      position: fixed; inset: 0;
      pointer-events: none;
      z-index: 15;
    }
    #walk-overlay.hidden { display: none; }

    #walk-crosshair {
      position: fixed;
      top: 50%; left: 50%;
      width: 4px; height: 4px;
      margin: -2px 0 0 -2px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.55);
      box-shadow: 0 0 6px rgba(0, 0, 0, 0.4);
      pointer-events: none;
    }

    #walk-height-panel {
      position: fixed;
      right: 20px;
      top: 50%;
      transform: translateY(-50%);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      pointer-events: auto;
      background: rgba(0, 0, 0, 0.55);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      padding: 16px 10px;
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.08);
    }
    .walk-height-label {
      font-size: 0.65rem;
      color: #888;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }
    #walk-height {
      writing-mode: vertical-lr;
      direction: rtl;
      height: 140px;
      width: 20px;
      accent-color: #6c63ff;
      cursor: pointer;
    }
    #walk-height-value {
      font-size: 0.8rem;
      color: #ccc;
      font-variant-numeric: tabular-nums;
    }

    #walk-hint {
      position: fixed;
      bottom: 28px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.55);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      padding: 10px 28px;
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      font-size: 0.8rem;
      color: #bbb;
      letter-spacing: 0.02em;
      white-space: nowrap;
      pointer-events: none;
    }

    #walk-exit {
      position: fixed;
      bottom: 28px;
      right: 20px;
      pointer-events: auto;
      padding: 10px 22px;
      background: rgba(0, 0, 0, 0.55);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      color: #eee;
      border: 1px solid rgba(255, 255, 255, 0.12);
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.82rem;
      font-weight: 500;
      transition: background 0.2s;
    }
    #walk-exit:hover { background: rgba(198, 40, 40, 0.6); }
  </style>
</head>
<body>
  <!-- Upload overlay -->
  <div id="upload-overlay">
    <h1>ğŸ  Digital Twin Viewer</h1>
    <p>Upload a point cloud scan to visualise it</p>
    <div id="drop-zone">
      <div class="icon">ğŸ“</div>
      <div class="label">Drop a <strong>.ply</strong> or <strong>.e57</strong> file here</div>
      <div class="hint">or click to browse</div>
      <input type="file" id="file-input" accept=".ply,.e57" />
    </div>
    <div id="upload-status"></div>
  </div>

  <!-- Three.js canvas -->
  <div id="canvas-container"></div>

  <!-- Floating labels for drawn wall previews -->
  <div id="floating-labels"></div>

  <!-- Walk-through overlay -->
  <div id="walk-overlay" class="hidden">
    <div id="walk-crosshair"></div>
    <div id="walk-height-panel">
      <span class="walk-height-label">Eye Height</span>
      <input type="range" id="walk-height" min="0.5" max="3.0" step="0.05" value="1.65" />
      <span id="walk-height-value">1.65 m</span>
    </div>
    <div id="walk-hint"></div>
    <button id="walk-exit">Exit Walkthrough</button>
  </div>

  <!-- HUD (shown after load) -->
  <div id="hud" style="display:none">
    <h2>ğŸ“Š Scan Info</h2>
    <div class="row"><span>File</span> <span id="hud-file">â€”</span></div>
    <div class="row"><span>Points</span> <span id="hud-points">â€”</span></div>
    <div class="row"><span>Planes</span> <span id="hud-planes">â€”</span></div>
    <div class="row"><span>Walls</span> <span id="hud-walls">â€”</span></div>
    <div class="row"><span>Floor</span> <span id="hud-floor">â€”</span></div>
  </div>

  <!-- Controls panel (shown after load) -->
  <div id="controls" style="display:none">
    <h2>âš™ï¸ Overlays</h2>
    <label><input type="checkbox" id="toggle-points" checked /> Point Cloud</label>
    <label><input type="checkbox" id="toggle-planes" checked /> Detected Planes</label>
    <label><input type="checkbox" id="toggle-walls" checked /> Walls only</label>
    <label><input type="checkbox" id="toggle-floor" checked /> Floor</label>
    <div class="legend">
      <div class="legend-item"><div class="legend-swatch" style="background:#4caf50"></div> Floor</div>
      <div class="legend-item"><div class="legend-swatch" style="background:#ff9800"></div> Walls</div>
      <div class="legend-item"><div class="legend-swatch" style="background:#e91e63"></div> Manual</div>
    </div>
    <button id="btn-add-wall">+ Add Wall</button>
    <button id="btn-generate-all" style="display:none;background:#4caf50;margin-top:4px;">Generate All Drawn</button>
    <div id="manual-wall-status" style="font-size:0.8rem;color:#e91e63;margin-top:6px;min-height:1.2rem;"></div>
    <button id="btn-trim-wall">Trim Intersection</button>
    <button id="btn-edit-walls">Edit Walls</button>
    <button id="btn-normalize">Normalize Walls</button>
    <div id="action-status" style="font-size:0.8rem;color:#aaa;margin-top:6px;min-height:1.2rem;"></div>
    <hr style="border:none;border-top:1px solid #333;margin:10px 0 6px;" />
    <button id="btn-walkthrough">Walkthrough</button>
    <button id="btn-reset">Reset Camera</button>
    <button id="btn-new" style="background:#444; margin-top:4px;">Upload New</button>
  </div>

  <script type="module" src="/src/main.js"></script>
</body>
</html>
